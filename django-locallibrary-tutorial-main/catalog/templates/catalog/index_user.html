{%extends 'base_generic.html'%}

{% load django_bootstrap5 %}
{% block content %}
<h1>Логи пользователей</h1>
<select id="sorting">
  <option value="" {% if request.GET.sort == "" %}selected{% endif %}>По умолчанию</option>
  <option value="user" {% if request.GET.sort == "user" %}selected{% endif %}>По алфавиту</option>
  <option value="-timestamp" {% if request.GET.sort == "-timestamp" %}selected{% endif %}>Вывести с конца</option>
  <option value="timestamp" {% if request.GET.sort == "timestamp" %}selected{% endif %}>Вывести с начала</option>
</select>
<table class="table table-striped table-hover">
  <thead>
      <tr>
          <th scope="col">Действие</th>
          <th scope="col">Пользователь</th>
          <th scope="col">Время</th>
      </tr>
  </thead>
  <tbody>
      {% for log in page_obj.object_list %}
      <tr>
          <td>{{ log.action }}</td>
          <td>{{ log.user }}</td>
          <td>{{ log.timestamp }}</td>
      </tr>
      {% endfor %}
  </tbody>
</table>
{% include 'pagination.html'%}
{% endblock %}

<script>
  document.getElementById('sorting').addEventListener('change', function() {
      const sortValue = this.value;
      let url = window.location.href; // Получаем текущий URL

      // Если уже есть параметр сортировки, удаляем его
      url = url.replace(/(\?|&)sort=[^&]+/g, '');

      if (sortValue) {
          // Добавляем параметр сортировки
          if (url.includes('?')) {
              url += '&sort=' + sortValue;
          } else {
              url += '?sort=' + sortValue;
          }
      }

      window.location.href = url; // Перенаправляем на новый URL
  });
</script>


